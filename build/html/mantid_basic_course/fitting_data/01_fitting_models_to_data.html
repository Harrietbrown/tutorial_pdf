
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Fitting Models To Data &#8212; Mantid Documentation 4.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fit Model Choices" href="02_fit_model_choices.html" />
    <link rel="prev" title="Fitting Data" href="index.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fitting-models-to-data">
<span id="id1"></span><h1>Fitting Models To Data<a class="headerlink" href="#fitting-models-to-data" title="Permalink to this headline">¶</a></h1>
<p>Fitting is the modelling of data where parameters of a model are allowed
to vary during a fitting process until the agreement between model and
data has seen an improvement according to some cost function.</p>
<p>In summary the Mantid fitting provides</p>
<ul class="simple">
<li><p>General fitting capabilities</p></li>
<li><p>Fitting extras, that make use of data log file and instrument
geometry information to enhance the user fitting experience</p></li>
<li><p>Easily expandable</p></li>
</ul>
<p>The main focus of this basic course is to cover the basic mantid fitting
capabilities.</p>
<div class="section" id="simple-fitting">
<h2>Simple fitting<a class="headerlink" href="#simple-fitting" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>1. Plot a data set. We will use data from MUSR00015189_cropped.nxs
file.</p>
<p><a class="reference internal" href="../../_images/MUSRDataSet.png"><img alt="MUSRDataSet.png" src="../../_images/MUSRDataSet.png" style="width: 400px;" /></a></p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><ol class="arabic simple" start="2">
<li><p>Select the fitting tool button: <img alt="PeakFitToolbar.png" src="../../_images/PeakFitToolbar.png" /></p></li>
</ol>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><a class="reference internal" href="../../_images/MUSRDataSetFittingOn.png"><img alt="MUSRDataSetFittingOn.png" src="../../_images/MUSRDataSetFittingOn.png" style="width: 500px;" /></a></p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><ol class="arabic simple" start="3">
<li><p>Right click on the plot to select a fitting function.</p></li>
</ol>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><a class="reference internal" href="../../_images/AddOtherFunctionOption.png"><img alt="AddOtherFunctionOption.png" src="../../_images/AddOtherFunctionOption.png" style="width: 500px;" /></a></p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">: 4. Choose ExpDecay.</div>
<div class="line">: <img alt="ChooseExpDecay.png" src="../../_images/ChooseExpDecay.png" /></div>
<div class="line">: 5. Run Fit.</div>
<div class="line">: <img alt="RunFitOption.png" src="../../_images/RunFitOption.png" /></div>
<div class="line">: 6. Examine the results.</div>
<div class="line">: <a class="reference internal" href="../../_images/MUSRDataSetFittingResults.png"><img alt="MUSRDataSetFittingResults.png" src="../../_images/MUSRDataSetFittingResults.png" style="width: 500px;" /></a></div>
</div>
</div>
<div class="section" id="a-more-complex-case">
<h2>A more complex case<a class="headerlink" href="#a-more-complex-case" title="Permalink to this headline">¶</a></h2>
<div class="section" id="activating-the-fitting-tools">
<h3>Activating the fitting tools<a class="headerlink" href="#activating-the-fitting-tools" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Open any data, here HRP39182.raw and plot first spectrum</p></li>
<li><p>Zoom in on any peak, for example the peak near 93150 microseconds</p></li>
<li><p>Close to the zoom toolbar button, click on the Fit Function toolbar
button:
<img alt="PeakFitToolbar.png" src="../../_images/PeakFitToolbar.png" />.
If this toolbar is not visible ensure that View-&gt;Toolbars…-&gt;Plot is
ticked.</p></li>
</ol>
<div class="line-block">
<div class="line">What you should now see is something similar to</div>
<div class="line"><a class="reference internal" href="../../_images/FirstStartMantidPlotFitting_MBC.png"><img alt="FirstStartMantidPlotFitting_MBC.png" src="../../_images/FirstStartMantidPlotFitting_MBC.png" style="width: 500px;" /></a></div>
</div>
<p>Three things happens when you click on the Fit Function toolbar button</p>
<ul class="simple">
<li><p>The Fit Function toolbox, by default, will position itself on the
left side of MantidPlot (if not already docked somewhere else)</p></li>
<li><p>fit function items are adding to the plot, initially the two vertical
dashed lines highlighted in red in the image above</p></li>
<li><p>and additional right click menu options becomes available on the plot
window</p></li>
</ul>
</div>
<div class="section" id="selecting-the-fitting-range">
<h3>Selecting the fitting range<a class="headerlink" href="#selecting-the-fitting-range" title="Permalink to this headline">¶</a></h3>
<p>The fitting range is the region of the data where you will attempt to do
a fit.</p>
<p>This vertical dashed lines shows the fitting region of the data. These
are in sync with the Fit Function setting properties: StartX and EndX
values highlighted in green in the image above.</p>
<ol class="arabic simple">
<li><p>Use the mouse to adjust the vertical dashed lines and therefore the
fitting range. Notice the StartX and EndX get updated in the Fit
Function property browser.</p></li>
<li><p>Alternative adjust StartX and EndX in the Fit Function property
browser which will adjust the positions of the vertical dashed lines</p></li>
</ol>
</div>
<div class="section" id="other-fit-function-settings-properties">
<h3>Other Fit Function Settings properties<a class="headerlink" href="#other-fit-function-settings-properties" title="Permalink to this headline">¶</a></h3>
<p>In addition to StartX and EndX there are a number of other essential fit
setting properties including:</p>
<ul class="simple">
<li><p>Workspace and Workspace Index: what data to fit. Note typically you
should not need to update these manually, these gets updated
automatically as the Fit Function button is used to associate the Fit
Function toolbox with different plots</p></li>
<li><p>Minimizer: Here you chose between a number of minimizer to search for
better fit to a model</p></li>
<li><p>Cost function: The function used to specify the quality of a fit.</p></li>
<li><p>Plot Difference: When the result of a fit is displayed optionally the
difference between the model and the fit can also be displayed</p></li>
</ul>
<p>More documentation of these is available from <span class="xref std std-ref">Fitting</span>.</p>
</div>
<div class="section" id="setting-up-a-fit-model">
<h3>Setting up a fit model<a class="headerlink" href="#setting-up-a-fit-model" title="Permalink to this headline">¶</a></h3>
<p>Here start up with building up a model consisting of one peak and one
background function.</p>
<p>This can in fact be done using just the Fit Function toolbox. However in
practice it is advantegeous to also use the fitting tools available on
the plot and from the plot right click menu.</p>
<ol class="arabic">
<li><p>Select the right click plot menu option ‘Add peak…’. This pops up a
new window and in the combobox, select Gaussian. The mouse cursor
then changes to a cross. Move this cross near the top of the peak and
click any mouse button</p>
<blockquote>
<div><p><a class="reference internal" href="../../_images/JustAddedPeak.png"><img alt="JustAddedPeak.png" src="../../_images/JustAddedPeak.png" style="width: 400px;" /></a></p>
</div></blockquote>
</li>
<li><p>Click on the red line and drag it sideways to set the initial width
(FWHM) of the peak.</p>
<blockquote>
<div><p><a class="reference internal" href="../../_images/ChangePeakWidth.png"><img alt="ChangePeakWidth.png" src="../../_images/ChangePeakWidth.png" style="width: 400px;" /></a></p>
<p>Now you can see 3 red lines - one solid line indicating peak’s
position and height, and two dashed ones representing the width of
the peak. The dashed lines usually show the points of half peak’s
maximum. All three lines can be dragged within the plot to modify
its centre, height or with parameters which is instantly reflected
in the Fit Function browser.</p>
</div></blockquote>
</li>
<li><p>Select the right click plot menu option ‘Add background…’. This
pops up a new window and in the combobox, select FlatBackground</p></li>
</ol>
<p>The result of this is</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/PeakAndBackgroundSetup.png"><img alt="PeakAndBackgroundSetup.png" src="../../_images/PeakAndBackgroundSetup.png" style="width: 500px;" /></a>
</div>
<p>Note that a vertical line has appeared in the plot where the peak was
positioned and two fit function entries have appeared in the Fit
Function property browser called ‘f0-Gaussian’ and ‘f1-FlatBackground’.</p>
<p>In summary from the Fit Function property browser you have created model
consisting of a CompositeFunction which contains a Gaussian and a
flat-background. The CompositeFunction part means that the model is sum
of its parts, i.e. here the model is</p>
<p>`` ‘f0-Gaussian’ + ‘f1-FlatBackground’``</p>
</div>
<div class="section" id="adjusting-fit-function-parameter">
<h3>Adjusting fit function parameter<a class="headerlink" href="#adjusting-fit-function-parameter" title="Permalink to this headline">¶</a></h3>
<p>When you do fitting the starting fit function parameter values can
greatly affect both the speed and the result you obtain from fitting. In
general you want to use staring parameter that are a close as possible
to the result you want to obtain.</p>
<p>Fit tools are available on the plot to help you with doing this. In
doing this it can be helpful to turn on Plot Guess,</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/SelectPlotGuess.png"><img alt="SelectPlotGuess.png" src="../../_images/SelectPlotGuess.png" style="width: 200px;" /></a>
</div>
<p>what this means does is to plot how the model you have created looks
like compared to your data.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/PlotGuess.png"><img alt="PlotGuess.png" src="../../_images/PlotGuess.png" style="width: 400px;" /></a>
</div>
<p>The aim is to have this plot and your data overlap reasonable well
before you do the actual fit. Note this is not an absolute requirement
but your chances of a successful fit increase this way.</p>
</div>
<div class="section" id="saving-a-model">
<h3>Saving a model<a class="headerlink" href="#saving-a-model" title="Permalink to this headline">¶</a></h3>
<p>If you have spend a considerable amount of type setting up a model you
can save it and then load it later.</p>
<p><a class="reference internal" href="../../_images/SaveSetup.png"><img alt="SaveSetup.png" src="../../_images/SaveSetup.png" style="width: 300px;" /></a> <a class="reference internal" href="../../_images/ArrowRight.png"><img alt="ArrowRight.png" src="../../_images/ArrowRight.png" style="width: 100px;" /></a> <a class="reference internal" href="../../_images/SaveSetupDialog.png"><img alt="SaveSetupDialog.png" src="../../_images/SaveSetupDialog.png" style="width: 100px;" /></a></p>
<p>After saving the model it can be imported into Fit Function browser at
any time using Custom Setup option from the same menu. Importing
(loading) a model replaces all functions in the browser.</p>
</div>
<div class="section" id="tying-and-constraining-fit-parameters">
<h3>Tying and constraining fit parameters<a class="headerlink" href="#tying-and-constraining-fit-parameters" title="Permalink to this headline">¶</a></h3>
<p>Mantid fitting framework allows you to tie or constrain parameters
during the fit. We define tying as setting a parameter equal to a result
of an expression involving other parameters of the same function. The
expression can be a constant (doesn’t involve any parameters), in this
case we call the tied parameter fixed.</p>
<p>By constraining we understand setting conditions on acceptable values of
a parameter. For example limiting its value from below or above.</p>
<p>To set a constraint or a tie right click on a parameter name:</p>
<div class="figure align-center">
<img alt="TieConstraintContextManu.png" src="../../_images/TieConstraintContextManu.png" />
</div>
<p>The menu offers three options:</p>
<ul class="simple">
<li><p>Fix: tie this parameter to its current value.</p></li>
<li><p>Constraint: set a bounding constraining condition - define a lower or
upper bound, or both.</p></li>
<li><p>Tie: tie this parameter to an arbitrary expression.</p></li>
</ul>
<p>The tying expression can be as simple as a parameter name:</p>
<p><code class="docutils literal notranslate"><span class="pre">f0.Height</span></code></p>
<p>Note that parameter names of a model include prefixes such as “f0.”
which indicate the particular function they belong to.</p>
<p>A more interesting example is setting parameter f1.A0 from our earlier
model to formula</p>
<p><code class="docutils literal notranslate"><span class="pre">20</span><span class="pre">-</span><span class="pre">f0.Height</span></code></p>
<p>This will ensure that the maximum point is exactly 20 units above 0.</p>
</div>
<div class="section" id="execute-your-fit">
<h3>Execute your fit<a class="headerlink" href="#execute-your-fit" title="Permalink to this headline">¶</a></h3>
<p>After the model has been defined, its initial values are set, any ties
and constraints defined we are ready to run a fit. It is done by
selecting the Fit option from the Fit menu:</p>
<div class="figure align-center">
<img alt="RunFitOption.png" src="../../_images/RunFitOption.png" />
</div>
</div>
<div class="section" id="inspecting-a-fit-result">
<h3>Inspecting a fit result<a class="headerlink" href="#inspecting-a-fit-result" title="Permalink to this headline">¶</a></h3>
<p>After a successful fit the results can be examined in three ways.</p>
<ol class="arabic simple">
<li><p>The Fit Function property browser will show the fitted parameters
instead of their initial values.</p></li>
<li><p>A plot of the fitted model will be added to the graph along with the
difference with the original data.</p></li>
<li><p>Output workspaces will be created and available via the workspace
dock.</p></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/FitResults.png"><img alt="FitResults.png" src="../../_images/FitResults.png" style="width: 500px;" /></a>
</div>
<p>There are three output workspaces:</p>
<p>1. A TableWorkspace with the name suffixed with “_Parameters”. It
contains the fitting parameters and their corresponding errors.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/ParametersTable.png"><img alt="ParametersTable.png" src="../../_images/ParametersTable.png" style="width: 300px;" /></a>
</div>
<p>2. A MatrixWorkspace with the name suffixed with “_Workspace”. Its first
three spectra are: the original data, the calculated model, and the
difference.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/FitResultWorkspace.png"><img alt="FitResultWorkspace.png" src="../../_images/FitResultWorkspace.png" style="width: 350px;" /></a>
</div>
<p>3. A TableWorkspace with the name suffixed with
“_NormalisedCovarianceMatrix”. It contains the variance-covariance
matrix normalized to 100.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Mantid Documentation</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Mantid Basic Course</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html">Setting Up and Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms_workspaces_and_histories/index.html">Algorithms, Workspaces and Histories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loading_and_displaying_data/index.html">Loading and Displaying Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connecting_data_to_instruments/index.html">Connecting Data To Instruments</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Fitting Data</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fitting Models To Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_fit_model_choices.html">Fit Model Choices</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_intelligent_fitting.html">Intelligent Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../using_workbench/index.html">Mantid Workbench</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction_to_python/index.html">Introduction to Python</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Mantid Basic Course</a><ul>
  <li><a href="index.html">Fitting Data</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Fitting Data</a></li>
      <li>Next: <a href="02_fit_model_choices.html" title="next chapter">Fit Model Choices</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
        &copy; Copyright 2019, Mantid.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.0.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>